<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>API</title>
	<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
	<style>
		body {
			font-family: 'Ubuntu', sans-serif;
		}
		#app {
			position: relative;
			overflow: hidden;
			background-color: #F5F5F5;
		}
		#header {
			padding: 20px 0;
			background-color: #212121;
			color: #E0E0E0;
		}
		#main {
			padding: 30px 0;
		}
		.label {
			margin-bottom: 10px;
			width: 100%;
		}
		.fake-label {
			display: block;
			margin-bottom: 5px;
		}
		.main-title {
			border-bottom: 1px solid #E0E0E0;
			padding: 20px 0;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.main-title h2 a {
			text-decoration: none;
			color: inherit;
			transition: color .3s;
		}
		.main-title h2 a:hover {
			color: #424242;
		}
		.form-box {
			background-color: #EEEEEE;
			box-shadow: 0 0 10px 10px rgba(0, 0, 0, .075);
			padding: 30px;
			border-radius: 10px;
		}
		.pin {
			font-size: 12px;
			padding: 3px;
			border-radius: 4px;
			background-color: #000;
			color: #fff;
			display: block;
			margin-left: 5px;
			line-height: 1;
		}
		.pin.required {
			background-color: #C62828;
		}
		.input-group-text.btn {
			border-top-left-radius: 0;
			border-bottom-left-radius: 0;
		}
		.cmodal-backdrop {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background-color: rgba(0, 0, 0, .7);
			z-index: 10;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 15px;
		}
		.cmodal {
			background-color: #fff;
			max-width: 850px;
			width: 100%;
			padding: 30px;
			height: 100%;
			overflow-y: auto;
			overflow-x: hidden;
			border-radius: 10px;
		}
		.cmodal form {
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			height: 100%;
		}
		code {
			color: #212121
		}
		pre {
			margin: 0;
		}
		.fade-enter-active, .fade-leave-active {
			transition: opacity .5s;
		}
		.fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */ {
			opacity: 0;
		}
		.table th,
		.table td {
			vertical-align: baseline;
		}
	</style>
</head>
<body>
	<div id="app">
		<header id="header">
			<div class="container d-flex justify-content-between align-items-center">
				<strong class="title">{{base}}</strong>
				<div class="d-flex align-items-center">
					<form action="#" @submit.prevent="search">
						<input @input="search" v-model="api_search" type="text" class="form-control" placeholder="Search by path">
					</form>
				</div>
			</div>
		</header>
		<main id="main">
			<div class="container">
				<div class="row">
					<div class="col-md-4 offset-md-8">
						<form action="#" @submit.prevent="saveToken">
							<div class="input-group">
								<input v-model="token" type="text" class="form-control" placeholder="Token">
								<div class="input-group-append">
									<button type="submit" class="input-group-text btn btn-dark">Save</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="container" v-for="(rule, i) in rules" :key="i">
				<div class="main-title">
					<h2 class="mb-0"><a href="#" @click.prevent="rule.show = !rule.show">[{{rule.method}}] {{rule.path}}</a></h2>
					<a href="#" class="btn btn-dark" @click.prevent="rule.show = !rule.show">
						<span v-if="!rule.show">Show</span>
						<span v-else>Hide</span>
					</a>
				</div>
				<Transition name="fade">
					<div v-if="rule.show" class="row py-4">
						<div class="col-md-4">
							<p v-if="rule.doc">{{rule.doc}}</p>
							<ul>
								<li v-for="(item, j) in rule.form" :key="j" class="mb-3">
									<h4 class="d-flex align-items-center">
										{{item.name}} <span v-if="item.required" class="pin required">Required</span>
									</h4>
									<div>
										<strong class="title">Type: </strong>
										<span>{{item.type}}</span>
									</div>
								</li>
							</ul>
						</div>
						<div class="col-md-8">
							<form action="#" class="form-box" @submit.prevent="sendRequest(rule)">
								<h3 class="mb-4">Try it:</h3>
								<div v-for="(item, j) in rule.form" :key="j">
									<label v-if="item.type == 'string' || item.type == 'integer'" class="label mb-3">
										<span class="fake-label">{{item.name}} <sup v-if="item.required" class="text-danger">*</sup></span>
										<input type="text" :required="item.required" class="form-control" v-model="item.default">
									</label>
									<div v-else-if="item.type == 'boolean'" class="form-check mb-3">
										<input class="form-check-input" type="checkbox" v-model="item.default" :id="`${item.name}`" :required="item.required">
										<label class="form-check-label" :for="`${item.name}`">{{item.name}} <sup v-if="item.required" class="text-danger">*</sup></label>
									</div>
									<div v-else-if="item.type == 'array' && typeof item.form !== 'string'" class="label mb-3">
										<div class="d-flex align-items-center mb-2">
											<span class="fake-label mb-0">{{item.name}} <sup v-if="item.required" class="text-danger">*</sup></span>
											<a href="#" class="btn btn-dark btn-sm ms-2" @click.prevent="addItem(item)">+</a>
										</div>
										<div class="row mb-1 align-items-end" v-for="(subitem, j) in item.default" :key="j">
											<div class="col-md-5" v-for="(value, key) in subitem" :key="key">
												<label class="label mb-0">
													<span class="fake-label">{{(value, key)}}</span>
													<input type="text" class="form-control" v-model="subitem[key]">
												</label>
											</div>
											<div class="col-md-1 offset-md-1">
												<a href="#" class="btn btn-dark btn-sm mb-1 w-100" @click.prevent="removeItem(item.default, j)">-</a>
											</div>
										</div>
									</div>
									<div v-else-if="item.type == 'array' && typeof item.form === 'string'" class="label mb-3">
										<div class="d-flex align-items-center mb-2">
											<span class="fake-label mb-0">{{item.name}} <sup v-if="item.required" class="text-danger">*</sup></span>
											<a href="#" class="btn btn-dark btn-sm ms-2" @click.prevent="addItem(item)">+</a>
										</div>
										<label class="label mb-1 row align-items-end" v-for="(subitem, j) in item.default" :key="j">
											<div class="col-md-10">
												<input type="text" class="form-control" v-model="item.default[j]">
											</div>
											<div class="col-md-1 offset-md-1">
												<a href="#" class="btn btn-dark btn-sm mb-1 w-100" @click.prevent="removeItem(item.default, j)">-</a>
											</div>
										</label>
									</div>
									<div v-else-if="item.type == 'object'" class="mb-3">
										<div class="d-flex align-items-center mb-2">
											<span class="fake-label mb-0">{{item.name}} <sup v-if="item.required" class="text-danger">*</sup></span>
											<a v-if="!item.default || typeof item.default === 'string'" href="#" class="btn btn-dark btn-sm ms-2" @click.prevent="addObject(item)">+</a>
										</div>
										<div class="row mb-1">
											<div class="col-md-6" v-for="(value, key) in item.default" :key="key">
												<label class="label">
													<span class="fake-label">{{key}}</span>
													<input type="text" class="form-control" v-model="item.default[key]">
												</label>
											</div>
										</div>
									</div>
								</div>
								<input type="submit" class="btn btn-dark">
							</form>
						</div>
					</div>
				</Transition>
			</div>
		</main>
		<div class="cmodal-backdrop" v-if="responseModal" @click.self="responseModal = false;response = null;">
			<div class="cmodal">
				<div class="table-responsive">
					<table class="table table-striped table-bordered">
						<tr v-for="(value, key) in response" :key="key">
							<th scope="row" class="bg-light">{{key}}</th>
							<td class="p-0">
								<div v-if="typeof value !== 'string'">
									<table class="table table-striped">
										<tr v-for="(v, k) in value" :key="k">
											<th scope="row">{{k}}</th>
											<td><pre>{{v}}</pre></td>
										</tr>
									</table>
								</div>
								<pre class="p-2" v-else>{{value}}</pre>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
		crossorigin="anonymous"></script>
</body>
<script>
	var app = new Vue({
		el: '#app',
		data: {
			base: null,
			rules: null,
			api_search: '',
			token: null,
			responseModal: false,
			response: null
		},
		methods: {
			search() {
				this.rules = this.allRules.filter(item => {
					item.show = false;
					return item.path.indexOf(this.api_search) >= 0
				})
				if(this.rules.length == 1) {
					this.rules[0]['show'] = true;
				}
			},
			sendRequest(rule) {
				var data = {};
				rule.form.forEach(item => {
					if(item.default) {
						data[item.name] = item.default
					}
				})

				const requestOptions = {
					method: rule.method,
					headers: { 'Content-Type': 'application/json' }
				};
				if(this.token) {
					requestOptions['headers']['Authorization'] = `Bearer ${this.token}`
				}
				if(rule.method == 'POST' || rule.method == 'PUT') {
					requestOptions['body'] = JSON.stringify(data)
				}

				fetch(`${rule.url}`, requestOptions)
				.then(response => response.json())
				.then(data => {
					this.response = data;
					this.responseModal = true;
				});
			},
			saveToken() {
				localStorage.setItem('token', this.token);
			},
			removeItem(form, i) {
				form.splice(i, 1)
			},
			addObject(item) {
				this.$set(item, 'default', {})
				var data = {}
				item.form.forEach(subitem => {
					data[subitem.name] = subitem.default
				})
				this.$set(item, 'default', data)
			},
			addItem(item) {
				if (typeof item.default === 'string') {
					item.default = [];
				}

				if(Array.isArray(item.form) && item.type == 'array') {
					var data = {}
					item.form.forEach(subitem => {
						data[subitem.name] = subitem.default
					})
					item.default.push(data)
				} else if(item.form == 'array') {
					this.$set(item.default, item.default.length, [''])
				} else if(item.form == 'string') {
					this.$set(item.default, item.default.length, '')
				} else if(item.form == 'integer') {
					this.$set(item.default, item.default.length, 0)
				}
			}
		},
		mounted() {
			if(localStorage.getItem('token')) {
				this.token = localStorage.getItem('token');
			}

			fetch('{{DOCS_URL}}')
			.then(response => response.json())
			.then(data => {
				this.base = data.base;
				this.allRules = data.rules;
				data.rules.forEach(item => {
					this.$set(item, 'show', false);
				})
				this.rules = Object.assign({}, this.allRules)
			});
		}
	})
</script>
<script>var docs = {{DOCS_JSON}}</script>
</html>